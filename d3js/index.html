<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>d3js三 | 黄镇的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Welcome to 黄镇的博客! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. 开始阅读">
<meta property="og:type" content="article">
<meta property="og:title" content="d3js三">
<meta property="og:url" content="http://yoursite.com/d3js/index.html">
<meta property="og:site_name" content="黄镇的博客">
<meta property="og:description" content="Welcome to 黄镇的博客! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. 开始阅读">
<meta property="og:updated_time" content="2017-10-29T09:34:43.179Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="d3js三">
<meta name="twitter:description" content="Welcome to 黄镇的博客! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. 开始阅读">
  
    <link rel="alternate" href="/atom.xml" title="黄镇的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">黄镇的博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-d3js" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/d3js/" class="article-date">
  <time datetime="2017-10-29T09:28:32.136Z" itemprop="datePublished">2017-10-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      d3js三
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">黄镇的博客</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="开始阅读"><a href="#开始阅读" class="headerlink" title="开始阅读"></a>开始阅读</h2><h3 id="angular项目用到的知识点"><a href="#angular项目用到的知识点" class="headerlink" title="angular项目用到的知识点"></a>angular项目用到的知识点</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div></pre></td><td class="code"><pre><div class="line">柱形图是一种最简单的可视化图标，主要有矩形、文字标签、坐标轴组成。本文为简单起见，只绘制矩形的部分，用以讲解如何使用 D3 在 SVG 画布中绘图。</div><div class="line"></div><div class="line">柱形图</div><div class="line"></div><div class="line">画布是什么</div><div class="line">前几章的处理对象都是 HTML 的文字，没有涉及图形的制作。</div><div class="line"></div><div class="line">要绘图，首要需要的是一块绘图的“画布”。</div><div class="line"></div><div class="line">HTML 5 提供两种强有力的“画布”：SVG 和 Canvas。</div><div class="line"></div><div class="line">SVG 是什么</div><div class="line"></div><div class="line">SVG，指可缩放矢量图形（Scalable Vector Graphics），是用于描述二维矢量图形的一种图形格式，是由万维网联盟制定的开放标准。 SVG 使用 XML 格式来定义图形，除了 IE8 之前的版本外，绝大部分浏览器都支持 SVG，可将 SVG 文本直接嵌入 HTML 中显示。</div><div class="line"></div><div class="line">SVG 有如下特点：</div><div class="line"></div><div class="line">SVG 绘制的是矢量图，因此对图像进行放大不会失真。</div><div class="line">基于 XML，可以为每个元素添加 JavaScript 事件处理器。</div><div class="line">每个图形均视为对象，更改对象的属性，图形也会改变。</div><div class="line">不适合游戏应用。</div><div class="line">Canvas 是什么</div><div class="line"></div><div class="line">Canvas 是通过 JavaScript 来绘制 2D 图形，是 HTML 5 中新增的元素。</div><div class="line"></div><div class="line">Canvas 有如下特点：</div><div class="line"></div><div class="line">绘制的是位图，图像放大后会失真。</div><div class="line">不支持事件处理器。</div><div class="line">能够以 .png 或 .jpg 格式保存图像</div><div class="line">适合游戏应用</div><div class="line">添加画布</div><div class="line">D3 虽然没有明文规定一定要在 SVG 中绘图，但是 D3 提供了众多的 SVG 图形的生成器，它们都是只支持 SVG 的。因此，建议使用 SVG 画布。</div><div class="line"></div><div class="line">使用 D3 在 body 元素中添加 svg 的代码如下。</div><div class="line"></div><div class="line">var width = 300;  //画布的宽度</div><div class="line">var height = 300;   //画布的高度</div><div class="line"></div><div class="line">var svg = d3.select(<span class="string">"body"</span>)     //选择文档中的body元素</div><div class="line">    .append(<span class="string">"svg"</span>)          //添加一个svg元素</div><div class="line">    .attr(<span class="string">"width"</span>, width)       //设定宽度</div><div class="line">    .attr(<span class="string">"height"</span>, height);    //设定高度</div><div class="line">有了画布，接下来就可以在画布上作图了。</div><div class="line"></div><div class="line">绘制矩形</div><div class="line">本文绘制一个横向的柱形图。只绘制矩形，不绘制文字和坐标轴。</div><div class="line"></div><div class="line">在 SVG 中，矩形的元素标签是 rect。例如：</div><div class="line"></div><div class="line">&lt;svg&gt;</div><div class="line">&lt;rect&gt;&lt;/rect&gt;</div><div class="line">&lt;rect&gt;&lt;/rect&gt;</div><div class="line">&lt;/svg&gt;</div><div class="line">上面的 rect 里没有矩形的属性。矩形的属性，常用的有四个：</div><div class="line"></div><div class="line">x：矩形左上角的 x 坐标</div><div class="line">y：矩形左上角的 y 坐标</div><div class="line">width：矩形的宽度</div><div class="line">height：矩形的高度</div><div class="line">要注意，在 SVG 中，x 轴的正方向是水平向右，y 轴的正方向是垂直向下的。</div><div class="line"></div><div class="line">现在给出一组数据，要对此进行可视化。数据如下：</div><div class="line"></div><div class="line">var dataset = [ 250 , 210 , 170 , 130 , 90 ];  //数据（表示矩形的宽度）</div><div class="line">为简单起见，我们直接用数值的大小来表示矩形的像素宽度（后面会说到这不是一种好方法）。然后，添加以下代码。</div><div class="line"></div><div class="line">var rectHeight = 25;   //每个矩形所占的像素高度(包括空白)</div><div class="line"></div><div class="line">svg.selectAll(<span class="string">"rect"</span>)</div><div class="line">    .data(dataset)</div><div class="line">    .enter()</div><div class="line">    .append(<span class="string">"rect"</span>)</div><div class="line">    .attr(<span class="string">"x"</span>,20)</div><div class="line">    .attr(<span class="string">"y"</span>,<span class="keyword">function</span>(d,i)&#123;</div><div class="line">         <span class="built_in">return</span> i * rectHeight;</div><div class="line">    &#125;)</div><div class="line">    .attr(<span class="string">"width"</span>,<span class="keyword">function</span>(d)&#123;</div><div class="line">         <span class="built_in">return</span> d;</div><div class="line">    &#125;)</div><div class="line">    .attr(<span class="string">"height"</span>,rectHeight-2)</div><div class="line">    .attr(<span class="string">"fill"</span>,<span class="string">"steelblue"</span>);</div><div class="line">这段代码添加了与 dataset 数组的长度相同数量的矩形，所使用的语句是：</div><div class="line"></div><div class="line">svg.selectAll(<span class="string">"rect"</span>)   //选择svg内所有的矩形</div><div class="line">    .data(dataset)  //绑定数组</div><div class="line">    .enter()        //指定选择集的enter部分</div><div class="line">    .append(<span class="string">"rect"</span>) //添加足够数量的矩形元素</div><div class="line">这段代码以后会常常出现在 D3 的代码中，请务必牢记。目前不深入讨论它的作用机制是怎样的，只需要读者牢记，当：</div><div class="line"></div><div class="line">有数据，而没有足够图形元素的时候，使用此方法可以添加足够的元素。</div><div class="line"></div><div class="line">添加了元素之后，就需要分别给各元素的属性赋值。在这里用到了 <span class="keyword">function</span>(d, i)，前面已经讲过，d 代表与当前元素绑定的数据，i 代表索引号。给属性赋值的时候，是需要用到被绑定的数据，以及索引号的。</div><div class="line"></div><div class="line">最后一行的：</div><div class="line"></div><div class="line">.attr(<span class="string">"fill"</span>,<span class="string">"steelblue"</span>);</div><div class="line">是给矩形元素设置颜色。一般来说，最好写成外置 CSS 的形式，方便归类和修改。这里为了便于初学者理解，将样式直接写到元素里。</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">一个完整的柱形图包含三部分：矩形、文字、坐标轴。本章将对前几章的内容进行综合的运用，制作一个实用的柱形图，内容包括：选择集、数据绑定、比例尺、坐标轴等内容。</div><div class="line"></div><div class="line">柱形图</div><div class="line"></div><div class="line">添加 SVG 画布</div><div class="line">//画布大小</div><div class="line">var width = 400;</div><div class="line">var height = 400;</div><div class="line"></div><div class="line">//在 body 里添加一个 SVG 画布   </div><div class="line">var svg = d3.select(<span class="string">"body"</span>)</div><div class="line">    .append(<span class="string">"svg"</span>)</div><div class="line">    .attr(<span class="string">"width"</span>, width)</div><div class="line">    .attr(<span class="string">"height"</span>, height);</div><div class="line"></div><div class="line">//画布周边的空白</div><div class="line"> var padding = &#123;left:30, right:30, top:20, bottom:20&#125;;</div><div class="line">上面定义了一个 padding，是为了给 SVG 的周边留一个空白，最好不要将图形绘制到边界上。</div><div class="line"></div><div class="line">定义数据和比例尺</div><div class="line">//定义一个数组</div><div class="line">var dataset = [10, 20, 30, 40, 33, 24, 12, 5];</div><div class="line"></div><div class="line">//x轴的比例尺</div><div class="line">var xScale = d3.scale.ordinal()</div><div class="line">    .domain(d3.range(dataset.length))</div><div class="line">    .rangeRoundBands([0, width - padding.left - padding.right]);</div><div class="line"></div><div class="line">//y轴的比例尺</div><div class="line">var yScale = d3.scale.linear()</div><div class="line">    .domain([0,d3.max(dataset)])</div><div class="line">    .range([height - padding.top - padding.bottom, 0]);</div><div class="line">x 轴使用序数比例尺，y 轴使用线性比例尺。要注意两个比例尺值域的范围。</div><div class="line"></div><div class="line">定义坐标轴</div><div class="line">//定义x轴</div><div class="line">var xAxis = d3.svg.axis()</div><div class="line">    .scale(xScale)</div><div class="line">    .orient(<span class="string">"bottom"</span>);</div><div class="line"></div><div class="line">//定义y轴</div><div class="line">var yAxis = d3.svg.axis()</div><div class="line">    .scale(yScale)</div><div class="line">    .orient(<span class="string">"left"</span>);</div><div class="line">x 轴刻度的方向向下，y 轴的向左。</div><div class="line"></div><div class="line">添加矩形和文字元素</div><div class="line">//矩形之间的空白</div><div class="line">var rectPadding = 4;</div><div class="line"></div><div class="line">//添加矩形元素</div><div class="line">var rects = svg.selectAll(<span class="string">".MyRect"</span>)</div><div class="line">        .data(dataset)</div><div class="line">        .enter()</div><div class="line">        .append(<span class="string">"rect"</span>)</div><div class="line">        .attr(<span class="string">"class"</span>,<span class="string">"MyRect"</span>)</div><div class="line">        .attr(<span class="string">"transform"</span>,<span class="string">"translate("</span> + padding.left + <span class="string">","</span> + padding.top + <span class="string">")"</span>)</div><div class="line">        .attr(<span class="string">"x"</span>, <span class="keyword">function</span>(d,i)&#123;</div><div class="line">            <span class="built_in">return</span> xScale(i) + rectPadding/2;</div><div class="line">        &#125; )</div><div class="line">        .attr(<span class="string">"y"</span>,<span class="keyword">function</span>(d)&#123;</div><div class="line">            <span class="built_in">return</span> yScale(d);</div><div class="line">        &#125;)</div><div class="line">        .attr(<span class="string">"width"</span>, xScale.rangeBand() - rectPadding )</div><div class="line">        .attr(<span class="string">"height"</span>, <span class="keyword">function</span>(d)&#123;</div><div class="line">            <span class="built_in">return</span> height - padding.top - padding.bottom - yScale(d);</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">//添加文字元素</div><div class="line">var texts = svg.selectAll(<span class="string">".MyText"</span>)</div><div class="line">        .data(dataset)</div><div class="line">        .enter()</div><div class="line">        .append(<span class="string">"text"</span>)</div><div class="line">        .attr(<span class="string">"class"</span>,<span class="string">"MyText"</span>)</div><div class="line">        .attr(<span class="string">"transform"</span>,<span class="string">"translate("</span> + padding.left + <span class="string">","</span> + padding.top + <span class="string">")"</span>)</div><div class="line">        .attr(<span class="string">"x"</span>, <span class="keyword">function</span>(d,i)&#123;</div><div class="line">            <span class="built_in">return</span> xScale(i) + rectPadding/2;</div><div class="line">        &#125; )</div><div class="line">        .attr(<span class="string">"y"</span>,<span class="keyword">function</span>(d)&#123;</div><div class="line">            <span class="built_in">return</span> yScale(d);</div><div class="line">        &#125;)</div><div class="line">        .attr(<span class="string">"dx"</span>,<span class="function"><span class="title">function</span></span>()&#123;</div><div class="line">            <span class="built_in">return</span> (xScale.rangeBand() - rectPadding)/2;</div><div class="line">        &#125;)</div><div class="line">        .attr(<span class="string">"dy"</span>,<span class="keyword">function</span>(d)&#123;</div><div class="line">            <span class="built_in">return</span> 20;</div><div class="line">        &#125;)</div><div class="line">        .text(<span class="keyword">function</span>(d)&#123;</div><div class="line">            <span class="built_in">return</span> d;</div><div class="line">        &#125;);</div><div class="line">矩形元素和文字元素的 x 和 y 坐标要特别注意，要结合比例尺给予适当的值。</div><div class="line"></div><div class="line">添加坐标轴的元素</div><div class="line">//添加x轴</div><div class="line">svg.append(<span class="string">"g"</span>)</div><div class="line">  .attr(<span class="string">"class"</span>,<span class="string">"axis"</span>)</div><div class="line">  .attr(<span class="string">"transform"</span>,<span class="string">"translate("</span> + padding.left + <span class="string">","</span> + (height - padding.bottom) + <span class="string">")"</span>)</div><div class="line">  .call(xAxis); </div><div class="line"></div><div class="line">//添加y轴</div><div class="line">svg.append(<span class="string">"g"</span>)</div><div class="line">  .attr(<span class="string">"class"</span>,<span class="string">"axis"</span>)</div><div class="line">  .attr(<span class="string">"transform"</span>,<span class="string">"translate("</span> + padding.left + <span class="string">","</span> + padding.top + <span class="string">")"</span>)</div><div class="line">  .call(yAxis);</div><div class="line">坐标轴的位置要结合空白 padding 的值来设定。</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">制作饼状图</div><div class="line"></div><div class="line"></div><div class="line">数据</div><div class="line">有如下数据，需要可视化：</div><div class="line"></div><div class="line">var dataset = [ 30 , 10 , 43 , 55 , 13 ];</div><div class="line">这样的值是不能直接绘图的。例如绘制饼状图的一个部分，需要知道一段弧的起始角度和终止角度，这些值都不存在于数组 dataset 中。因此，需要用到布局，布局的作用就是：</div><div class="line"></div><div class="line">计算出适合于作图的数据。</div><div class="line"></div><div class="line">这一个过程，在本教程中为了方便理解，笔者称之为“数据转换”。</div><div class="line"></div><div class="line">布局（数据转换）</div><div class="line">定义一个布局，</div><div class="line"></div><div class="line">var pie = d3.layout.pie();</div><div class="line">返回值赋给变量 pie，此时 pie 可以当做函数使用。</div><div class="line"></div><div class="line">var piedata = pie(dataset);</div><div class="line">将数组 dataset 作为 pie() 的参数，返回值给 piedata。如此一来，</div><div class="line"></div><div class="line">piedata 就是转换后的数据。</div><div class="line"></div><div class="line">简单吧，非常轻松就得到了。在控制台输出 piedata ，让我们来看看数据转换成什么了。</div><div class="line"></div><div class="line">转换后的数据</div><div class="line"></div><div class="line">如上图所示，5 个整数被转换成了 5 个对象（Object） ，每个对象都有变量起始角度（startAngle）和终止角度（endAngle），还有原数据（属性名称为 data）。这些都是绘图需要的数据。</div><div class="line"></div><div class="line">千万记住：布局要直接绘图，而是为了得到绘图所需的数据。</div><div class="line"></div><div class="line">绘制图形</div><div class="line">为了根据转换后的数据 piedata 来作图，还需要一样工具：生成器。</div><div class="line"></div><div class="line">SVG 有一个元素，叫做路径 path，是 SVG 中功能最强的元素，它可以表示其它任意的图形。顾名思义，路径元素就是通过定义一个段“路径”，来绘制出各种图形。但是，路径是很难计算的，通过布局转换后的数据 piedata 仍然很难手动计算得到路径值。为我们完成这项任务的，就是生成器。</div><div class="line"></div><div class="line">这里要用到的叫做弧生成器，能够生成弧的路径，因为饼图的每一部分都是一段弧。</div><div class="line"></div><div class="line">var outerRadius = 150; //外半径</div><div class="line">var innerRadius = 0; //内半径，为0则中间没有空白</div><div class="line"></div><div class="line">var arc = d3.svg.arc()  //弧生成器</div><div class="line">    .innerRadius(innerRadius)   //设置内半径</div><div class="line">    .outerRadius(outerRadius);  //设置外半径</div><div class="line">弧生成器返回的结果赋值给 arc。此时，arc 可以当做一个函数使用，把 piedata 作为参数传入，即可得到路径值。</div><div class="line"></div><div class="line">接下来，可以在 SVG 中添加图形元素了。先在 svg 里添加足够数量（5个）个分组元素（g），每一个分组用于存放一段弧的相关元素。</div><div class="line"></div><div class="line">var arcs = svg.selectAll(<span class="string">"g"</span>)</div><div class="line">    .data(piedata)</div><div class="line">    .enter()</div><div class="line">    .append(<span class="string">"g"</span>)</div><div class="line">    .attr(<span class="string">"transform"</span>,<span class="string">"translate("</span>+ (width/2) +<span class="string">","</span>+ (width/2) +<span class="string">")"</span>);</div><div class="line">接下来对每个 g 元素，添加 path 。</div><div class="line"></div><div class="line">arcs.append(<span class="string">"path"</span>)</div><div class="line">    .attr(<span class="string">"fill"</span>,<span class="keyword">function</span>(d,i)&#123;</div><div class="line">        <span class="built_in">return</span> color(i);</div><div class="line">    &#125;)</div><div class="line">    .attr(<span class="string">"d"</span>,<span class="keyword">function</span>(d)&#123;</div><div class="line">        <span class="built_in">return</span> arc(d);   //调用弧生成器，得到路径值</div><div class="line">    &#125;);</div><div class="line">因为 arcs 是同时选择了 5 个 g 元素的选择集，所以调用 append(“path”) 后，每个 g 中都有 path 。路径值的属性名称是 d，调用弧生成器后返回的值赋值给它。要注意，arc(d) 的参数 d 是被绑定的数据。</div><div class="line"></div><div class="line">另外，color 是一个颜色比例尺，它能根据传入的索引号获取相应的颜色值，定义如下。</div><div class="line"></div><div class="line">var color = d3.scale.category10();   //有十种颜色的颜色比例尺</div><div class="line">然后在每一个弧线中心添加文本。</div><div class="line"></div><div class="line">arcs.append(<span class="string">"text"</span>)</div><div class="line">    .attr(<span class="string">"transform"</span>,<span class="keyword">function</span>(d)&#123;</div><div class="line">        <span class="built_in">return</span> <span class="string">"translate("</span> + arc.centroid(d) + <span class="string">")"</span>;</div><div class="line">    &#125;)</div><div class="line">    .attr(<span class="string">"text-anchor"</span>,<span class="string">"middle"</span>)</div><div class="line">    .text(<span class="keyword">function</span>(d)&#123;</div><div class="line">        <span class="built_in">return</span> d.data;</div><div class="line">    &#125;);</div><div class="line">arc.centroid(d) 能算出弧线的中心。要注意，text() 里返回的是 d.data ，而不是 d 。因为被绑定的数据是对象，里面有 d.startAngle、d.endAngle、d.data 等，其中 d.data 才是转换前的整数的值。</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/d3js/" data-id="cj9ck7ins0001agwyzusbfoou" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/react一/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          angular项目经验一
        
      </div>
    </a>
  
  
    <a href="/d3/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">d3js二</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/react一/">angular项目经验一</a>
          </li>
        
          <li>
            <a href="/d3js/">d3js三</a>
          </li>
        
          <li>
            <a href="/d3/">d3js二</a>
          </li>
        
          <li>
            <a href="/react/">react的学习</a>
          </li>
        
          <li>
            <a href="/angular6/">angular项目经验六</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>